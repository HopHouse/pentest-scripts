{
  lib,
  stdenv,
  makeWrapper,
  fetchzip,
  temurin-bin,
  maven,
  ruby,
  bundler,
  scala_3,
  sbt
}:

stdenv.mkDerivation rec {
  name = "joern";
  version = "2.0.417";

  src = fetchzip {
    url = "https://github.com/joernio/joern/releases/download/v${version}/joern-cli.zip";
    hash = "sha256-W8fMqrWmqAj3BJBsQbp/Mzyy+7xZhfohp71A16zyX48=";
  };

  nativeBuildInputs = [
    makeWrapper
  ];

  buildInputs = [
    temurin-bin
  ];

  buildPhase = ''
    mkdir -p $out/bin

    mkdir -p $out/joern-cli
    cp -r ./ $out/joern-cli

    wrapProgram $out/joern-cli/joern --set JAVA_HOME ${temurin-bin}
    wrapProgram $out/joern-cli/joern-parse --set JAVA_HOME ${temurin-bin}
    wrapProgram $out/joern-cli/c2cpg.sh --set JAVA_HOME ${temurin-bin}
    wrapProgram $out/joern-cli/ghidra2cpg --set JAVA_HOME ${temurin-bin}
    wrapProgram $out/joern-cli/jssrc2cpg.sh --set JAVA_HOME ${temurin-bin}
    wrapProgram $out/joern-cli/javasrc2cpg --set JAVA_HOME ${temurin-bin}
    wrapProgram $out/joern-cli/jimple2cpg --set JAVA_HOME ${temurin-bin}
    wrapProgram $out/joern-cli/kotlin2cpg --set JAVA_HOME ${temurin-bin}
    wrapProgram $out/joern-cli/php2cpg --set JAVA_HOME ${temurin-bin}
    wrapProgram $out/joern-cli/rubysrc2cpg --set JAVA_HOME ${temurin-bin}
    wrapProgram $out/joern-cli/pysrc2cpg --set JAVA_HOME ${temurin-bin}
    wrapProgram $out/joern-cli/joern-export --set JAVA_HOME ${temurin-bin}
    wrapProgram $out/joern-cli/joern-flow --set JAVA_HOME ${temurin-bin}
    wrapProgram $out/joern-cli/joern-scan --set JAVA_HOME ${temurin-bin}
    wrapProgram $out/joern-cli/joern-slice --set JAVA_HOME ${temurin-bin}
 
    ln -sf $out/joern-cli/joern $out/bin/
    ln -sf $out/joern-cli/joern-parse $out/bin/
    ln -sf $out/joern-cli/c2cpg.sh $out/bin/
    ln -sf $out/joern-cli/ghidra2cpg $out/bin/
    ln -sf $out/joern-cli/jssrc2cpg.sh $out/bin/
    ln -sf $out/joern-cli/javasrc2cpg $out/bin/
    ln -sf $out/joern-cli/jimple2cpg $out/bin/
    ln -sf $out/joern-cli/kotlin2cpg $out/bin/
    ln -sf $out/joern-cli/php2cpg $out/bin/
    ln -sf $out/joern-cli/rubysrc2cpg $out/bin/
    ln -sf $out/joern-cli/pysrc2cpg $out/bin/
    ln -sf $out/joern-cli/joern-export $out/bin/
    ln -sf $out/joern-cli/joern-flow $out/bin/
    ln -sf $out/joern-cli/joern-scan $out/bin/
    ln -sf $out/joern-cli/joern-slice $out/bin/
  '';
}
